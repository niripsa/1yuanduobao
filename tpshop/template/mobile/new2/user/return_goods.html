<include file="public/header" title="申请售后" body="f3"/>
<include file="public/header_nav" title="申请售后" href="javascript:history.back(-1)"/>
<form name="return_form" id="return_form" autocomplete="off" method="post" enctype="multipart/form-data" >
    <div class="div1">
        <div class="attention-shoppay applyafter">
            <div class="orderlistshpop tuharecha mabo20 p">
                <div class="maleri30">
                    <div class="sc_list se_sclist paycloseto">
                        <div class="shopimg fl">
                            <img title="{$goods.goods_name}" src="/tpshop/{$goods.goods_id|goods_thum_images=100,100}">
                        </div>
                        <div class="deleshow fr">
                            <div class="deletes">
                                <a class="daaloe">{$goods.goods_name}</a>
                            </div>
                            <div class="qxatten">
                                <div class="weight">
                                    <p><span>价格：</span><span><em>￥</em>{$goods.member_goods_price}</span></p>
                                    <p><span>数量：</span><span>x{$goods.goods_num}</span></p>
                                    <!--<a class="closeannten" href="javascript:void(0)">联系卖家</a>-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="seravetype">
            <div class="maleri30">
                <p>服务类型</p>
                <div class="fuwxbo">
                    <a href="javascript:void(0);" class="red">退货</a>
                    <if condition="$goods['is_send'] eq 0 or $goods['order_status'] eq 2">
                        <a href="javascript:void(0);">换货</a>
                    </if>
                    <input type="hidden" id="type"  value="0" name="type">
                </div>
            </div>
        </div>
        <div class="seravetype ma-to-20">
            <div class="maleri30">
                <p>检测报告</p>
                <div class="inspectrepot p">
                    <div class="radio">
                        <span class="che" id="credential">
                            <i></i>
                            <span>已有检测报告</span>
                        </span>
                    </div>
                </div>
                <p class="ifhaeu">若有检测报告请拍照上传</p>
            </div>
        </div>
        <div class="customer-messa apply-afterserve ma-to-20">
            <div class="maleri30">
                <p>问题描述</p>
                <textarea class="tapassa" onkeyup="checkfilltextarea('.tapassa','500')" name="reason" id="reason"  placeholder="请你在此描述详细问题"></textarea>
                <span class="xianzd"><em id="zero">500</em>/500</span>
            </div>
        </div>
        <div class="seravetype ma-to-20">
            <div class="maleri30">
                <p>上传照片</p>
                <ul id="imglen">
                    <label>
                        <li >
                            <div class="shcph" id="fileList0">
                                <img src="__STATIC__/images/camera.png">
                            </div>
                            <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,0)" style="display:none">
                        </li>
                    </label>
                    <label>
                        <li class="file">
                            <div class="shcph" id="fileList1">
                                <img src="__STATIC__/images/camera.png">
                            </div>
                            <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,1)" style="display:none">
                        </li>
                    </label>
                    <label>
                        <li class="file">
                            <div class="shcph" id="fileList2">
                                <img src="__STATIC__/images/camera.png">
                            </div>
                            <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,2)" style="display:none">
                        </li>
                    </label>
                    <label>
                        <li class="file">
                            <div class="shcph" id="fileList3">
                                <img src="__STATIC__/images/camera.png">
                            </div>
                            <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,3)" style="display:none">
                        </li>
                    </label>
                    <label>
                        <li class="file">
                            <div class="shcph" id="fileList4">
                                <img src="__STATIC__/images/camera.png">
                            </div>
                            <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,4)" style="display:none">
                        </li>
                    </label>
                </ul>
                </ul>
                <p class="ifhaeu">为帮助我们更好的解决问题，请上传照片。最多5张，每张不超过5M，支持JPG、BMP、PNG</p>
            </div>
        </div>
    </div>
<!--寄回地址s-->
    <div class="terurnmobil ma-to-20" >
        <div class="zblikbo p">
            <div class="qhsxix">
                <div class="myorder p">
                    <div class="order">
                        <div class="fl">
                            <span>寄回地址：</span>
                        </div>
                        <div class="fl">
                            <p class="addretu">{$tpshop_config['shop_info_address']} </p>
                        </div>
                    </div>
                </div>
                <div class="myorder p">
                    <div class="order">
                        <div class="fl">
                            <span>上班时间：</span>
                        </div>
                        <div class="fl">
                            <p class="addretu">（周一至周五）08:00-19:00</p>
                        </div>
                    </div>
                </div>
                <div class="myorder p">
                    <div class="order">
                        <div class="fl">
                            <span>客服电话：</span>
                        </div>
                        <div class="fl">
                            <p class="addretu">{$tpshop_config['shop_info_phone']}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="sunhj">
            <a href="javascript:void(0)" onClick="submit_form();" name="btnSubmit"><s></s>提交</a>
        </div>
    </div>
<!--寄回地址-e-->

    <input type="hidden" name="order_id" value="{$order_id}" />
    <input type="hidden" name="order_sn" value="{$order_sn}" />
    <input type="hidden" name="goods_id" value="{$goods_id}" />
    <input type="hidden" name="spec_key" value="{$Request.param.spec_key}" />
    <input type="hidden" name="new2" value="1" />
</form>
<script type="text/javascript">
    $(function(){
        //改变服务类型
        $('.fuwxbo a').click(function(){
            var n = $(this).index();
            $('#type').val(n);
            $(this).toggleClass('red').siblings().removeClass('red');
        })
    })

    //提交
    function submit_form()
    {
        var reason = $.trim($('#reason').val());
        var return_imgs= $.trim($('#return_imgs').val());
        if(reason == '')
        {
            layer.open({content:'请输入退换货原因',time:2});
            return false;
        }

        var ff = document.getElementsByName("return_imgs[]");

//        if((ff[0].value.length + ff[1].value.length + ff[2].value.length + ff[3].value.length) == 0)
        if(ff[0].value.length  == 0)
        {
            if($('#credential').hasClass('check_t')){
                layer.open({content:'请上传检测报告图片',time:2});
                return false;
            }
            if(!confirm('确定不传照片吗?'))
            {
                return false;
            }
        }
        $('#return_form').submit();
    }

    //上传照片
    window.URL = window.URL || window.webkitURL;
    function handleFiles(obj,id) {
        fileList = document.getElementById("fileList"+id);
        var files = obj.files;
        img = new Image();
        if(window.URL){

            img.src = window.URL.createObjectURL(files[0]); //创建一个object URL，并不是你的本地路径
            img.width = 60;
            img.height = 60;
            img.onload = function(e) {
                window.URL.revokeObjectURL(this.src); //图片加载后，释放object URL
            }
            if(fileList.firstElementChild){
                fileList.removeChild(fileList.firstElementChild);
            }
            fileList.appendChild(img);
        }else if(window.FileReader){
            //opera不支持createObjectURL/revokeObjectURL方法。我们用FileReader对象来处理
            var reader = new FileReader();
            reader.readAsDataURL(files[0]);
            reader.onload = function(e){
                img.src = this.result;
                img.width = 60;
                img.height = 60;
                fileList.appendChild(img);
            }
        }else
        {
            //ie
            obj.select();
            obj.blur();
            var nfile = document.selection.createRange().text;
            document.selection.empty();
            img.src = nfile;
            img.width = 60;
            img.height = 60;
            img.onload=function(){

            }
            fileList.appendChild(img);
        }
    }
</script>
</body>
</html>
